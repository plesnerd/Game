<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Soccer Crate Opener</title>
<style>
  :root{--bg:#081023;--card:#0e1a2b;--accent:#1db954;--muted:#9fb3c8;--glass: rgba(255,255,255,0.04)}
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;background:linear-gradient(180deg,#061023 0%, #081733 60%);color: #e6f2ff;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:30px}
  .app{width:980px;max-width:96%;min-height:640px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:18px;padding:20px;box-shadow:0 10px 40px rgba(2,8,23,0.6);display:grid;grid-template-columns:360px 1fr;gap:18px}
  header{display:flex;gap:10px;align-items:center}
  .logo{width:56px;height:56px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#3ac17f);display:flex;align-items:center;justify-content:center;font-weight:800;color:#042;box-shadow:0 6px 20px rgba(29,185,84,0.12)}
  h1{margin:0;font-size:18px}
  .left{padding:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px}
  .crate-wrap{display:flex;flex-direction:column;align-items:center;gap:12px}
  .crate{width:220px;height:220px;border-radius:14px;background:linear-gradient(180deg,#0c2a3d,#072032);display:flex;align-items:center;justify-content:center;position:relative;box-shadow:inset 0 -6px 30px rgba(0,0,0,0.6), 0 14px 35px rgba(2,8,23,0.6)}
  .crate img{width:130px;height:130px;object-fit:cover;object-position:center top;border-radius:8px;border:6px solid rgba(255,255,255,0.03)}
  .crate.spin{animation:spinCrate 1.3s cubic-bezier(.1,.8,.2,1)}
  @keyframes spinCrate{0%{transform:rotateX(0) rotateZ(0) translateY(0)}50%{transform:rotateX(50deg) rotateZ(180deg) translateY(-8px)}100%{transform:rotateX(0) rotateZ(360deg) translateY(0)}}
  .button{display:inline-flex;padding:12px 18px;border-radius:12px;background:linear-gradient(90deg,var(--accent),#16a06b);color:#00222a;font-weight:700;border:none;cursor:pointer;box-shadow:0 8px 30px rgba(20,160,100,0.12);transition:transform .15s}
  .button:active{transform:translateY(2px)}
  .controls{display:flex;gap:10px;align-items:center}
  .info{display:flex;gap:8px;align-items:center}
  .coins{background:var(--glass);padding:10px;border-radius:10px;color:var(--muted);min-width:80px;text-align:center}
  .inventory{margin-top:14px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02));padding:12px;border-radius:10px}
  .inv-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
  .inv-item{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:6px;border-radius:8px;display:flex;gap:8px;align-items:center}
  .inv-item img{width:44px;height:44px;object-fit:cover;border-radius:6px}

  /* right column */
  .right{padding:18px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));border-radius:12px;overflow:hidden}
  .tabs{display:flex;gap:8px;margin-bottom:12px}
  .tab{padding:8px 12px;border-radius:10px;background:transparent;border:1px solid rgba(255,255,255,0.03);cursor:pointer;color:var(--muted)}
  .tab.active{background:linear-gradient(90deg,#06272f,#063b3d);color:var(--accent);border-color:rgba(29,185,84,0.14)}
  .pool{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
  .player{background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));border-radius:10px;padding:8px;display:flex;flex-direction:column;align-items:center;gap:8px}
  .player img{width:100%;height:110px;object-fit:cover;object-position:center top;border-radius:8px}
  .rarity{font-weight:700;padding:6px 10px;border-radius:999px;font-size:12px}
  .rarity.common{background:#183a4e;color:#bfe2ff}
  .rarity.rare{background:#3b2b83;color:#e8dcff}
  .rarity.epic{background:#842d7a;color:#ffd6f2}
  .rarity.legendary{background:linear-gradient(90deg,#ffcc00,#ff7a00);color:#2b1a00}

  /* reveal overlay */
  .reveal{position:fixed;inset:0;background:rgba(2,6,12,0.6);display:flex;align-items:center;justify-content:center;z-index:50;backdrop-filter: blur(6px);opacity:0;pointer-events:none;transition:opacity .25s}
  .reveal.show{opacity:1;pointer-events:auto}
  .card{width:420px;background:linear-gradient(180deg,#092033,#071726);border-radius:14px;padding:18px;box-shadow:0 20px 60px rgba(2,6,23,0.7);transform:translateY(20px);transition:transform .22s}
  .card.show{transform:translateY(0)}
  .reveal-img{width:220px;height:220px;border-radius:12px;overflow:hidden;margin:0 auto;box-shadow:0 14px 40px rgba(2,6,23,0.6)}
  .reveal-img img{width:100%;height:100%;object-fit:cover;object-position:center top;transform:scale(.9);transition:transform .6s cubic-bezier(.2,.8,.2,1)}
  .reveal-img.show img{transform:scale(1)}
  .label{margin-top:12px;text-align:center}
  .close{margin-top:12px;display:flex;justify-content:center}

  /* confetti */
  .confetti-piece{position:absolute;width:10px;height:14px;opacity:0;transform:translateY(-20px) rotateZ(0)}

  @media (max-width:900px){.app{grid-template-columns:1fr;grid-auto-rows:auto}}
  .reel-container{width:100%;max-width:520px;height:140px;overflow:hidden;position:relative;border-radius:12px;background:linear-gradient(180deg,#061c2f,#041422);box-shadow:inset 0 0 30px rgba(0,0,0,0.6)}
  .reel{display:flex;gap:12px;position:absolute;left:0;top:50%;transform:translateY(-50%)}
  .reel-item{width:120px;height:120px;border-radius:10px;background:rgba(255,255,255,0.04);display:flex;flex-direction:column;align-items:center;justify-content:center;padding:6px;flex-shrink:0}
  .reel-item img{width:100%;height:80px;object-fit:cover;object-position:center top;border-radius:6px}
  .reel-item .rarity{margin-top:4px}
  .reel-marker{position:absolute;top:0;bottom:0;left:50%;width:4px;background:linear-gradient(180deg,transparent,#ffd700,transparent);box-shadow:0 0 18px #ffd700}

</style>
</head>
<body>
  <div class="app" role="application">
    <div class="left">
      <header style="display:flex;align-items:center;gap:12px;margin-bottom:12px">
        <div class="logo">⚽</div>
        <div>
          <h1>Soccer Crate Opener</h1>
          <div style="color:var(--muted);font-size:13px">Open crates, collect players & check rarities</div>
        </div>
      </header>

      <div class="crate-wrap">
        <!-- CS:GO style reel -->
        <div class="reel-container" id="reelContainer">
          <div class="reel" id="reel"></div>
          <div class="reel-marker"></div>
        </div>
        <div class="crate" id="crate">
          <img id="crate-player" src="https://upload.wikimedia.org/wikipedia/commons/6/6c/Lionel_Messi_in_2018.jpg" alt="crate player">
        </div>

        <div class="controls">
          <button class="button" id="openBtn">Open Crate (10 coins)</button>
          <div class="info">
            <div class="coins" id="coins">Coins: 0</div>
            <button class="tab" id="resetBtn">Reset</button>
          </div>
        </div>

        <div class="inventory">
          <div style="display:flex;justify-content:space-between;align-items:center"><strong>Inventory</strong><small style="color:var(--muted)">Saved automatically</small></div>
          <div class="inv-grid" id="invGrid"></div>
        </div>
      </div>
    </div>

    <div class="right">
      <div class="tabs">
        <button class="tab active" data-tab="pool">Player Pool</button>
        <button class="tab" data-tab="rarities">Rarities</button>
        <button class="tab" data-tab="stats">Stats</button>
      </div>
      <div id="poolView">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
          <div style="color:var(--muted)">Players available in crates</div>
          <div style="color:var(--muted);font-size:13px">Lucky spin animation & polished reveal</div>
        </div>
        <div class="pool" id="pool"></div>
      </div>

      <div id="raritiesView" style="display:none">
        <h3 style="margin-top:0">Rarities</h3>
        <div style="display:flex;gap:12px;flex-wrap:wrap">
          <div style="flex:1;min-width:220px;background:var(--card);padding:12px;border-radius:10px">
            <h4 style="margin:6px 0">Drop rates</h4>
            <ul style="color:var(--muted);line-height:1.6">
              <li><strong>Legendary</strong> — 5% (top players)</li>
              <li><strong>Epic</strong> — 10%</li>
              <li><strong>Rare</strong> — 25%</li>
              <li><strong>Common</strong> — 60%</li>
            </ul>
          </div>
          <div style="flex:1;min-width:220px;background:var(--card);padding:12px;border-radius:10px">
            <h4 style="margin:6px 0">How rarity affects</h4>
            <div style="color:var(--muted)">Rarer players have lower drop chance and a more dramatic reveal animation. All items are collectible and saved locally.</div>
          </div>
        </div>
        <div style="margin-top:12px" id="rarList"></div>
      </div>

      <div id="statsView" style="display:none">
        <h3 style="margin-top:0">Your Stats</h3>
        <div id="statsArea" style="color:var(--muted)"></div>
      </div>
    </div>

    <!-- reveal modal -->
    <div class="reveal" id="reveal">
      <div class="card" id="revealCard">
        <div style="text-align:center;font-size:13px;color:var(--muted)">You pulled</div>
        <div class="reveal-img" id="revealImg"><img id="revealPlayerImg" src="" alt="player"></div>
        <div class="label"><div id="revealName" style="font-weight:800;font-size:18px;margin-top:8px"></div><div id="revealRarity" style="margin-top:6px"></div></div>
        <div class="close"><button class="button" id="closeReveal">Close</button></div>
      </div>
    </div>

    <!-- confetti pieces (will be generated) -->
  </div>

<script>
/* ====== Data ====== */
// NOTE: Using reliable Wikimedia portrait-style images + graceful fallback
const ITEMS = [
  {id:'messi',name:'Lionel Messi',rarity:'legendary',img:'https://upload.wikimedia.org/wikipedia/commons/c/c1/Lionel_Messi_20180626.jpg'},
  {id:'ronaldo',name:'Cristiano Ronaldo',rarity:'legendary',img:'https://upload.wikimedia.org/wikipedia/commons/8/8c/Cristiano_Ronaldo_2018.jpg'},
  {id:'mbappe',name:'Kylian Mbappé',rarity:'epic',img:'https://upload.wikimedia.org/wikipedia/commons/8/89/Kylian_Mbapp%C3%A9_2019.jpg'},
  {id:'neymar',name:'Neymar Jr',rarity:'epic',img:'https://upload.wikimedia.org/wikipedia/commons/5/5c/Neymar_2018.jpg'},
  {id:'debruyne',name:'Kevin De Bruyne',rarity:'rare',img:'https://upload.wikimedia.org/wikipedia/commons/3/36/Kevin_De_Bruyne.jpg'},
  {id:'salah',name:'Mohamed Salah',rarity:'rare',img:'https://upload.wikimedia.org/wikipedia/commons/8/86/Mohamed_Salah_2018.jpg'},
  {id:'haaland',name:'Erling Haaland',rarity:'epic',img:'https://upload.wikimedia.org/wikipedia/commons/5/5f/Erling_Haaland_2023.jpg'},
  {id:'lewandowski',name:'Robert Lewandowski',rarity:'common',img:'https://upload.wikimedia.org/wikipedia/commons/5/5c/Robert_Lewandowski_2019.jpg'}
];
const RATES = {legendary:0.05, epic:0.10, rare:0.25, common:0.60};
const OPEN_COST = 10;

/* ====== State (persisted) ====== */
const STORAGE_KEY = 'soccerCrate_save_v1';
let state = {coins:200, inventory:{}, opened:0};

function load(){
  try{const s=localStorage.getItem(STORAGE_KEY); if(s) state=JSON.parse(s);}catch(e){console.error('load',e)}
}
function save(){localStorage.setItem(STORAGE_KEY,JSON.stringify(state));}

/* ====== UI Render ====== */
const poolEl = document.getElementById('pool');
const invGrid = document.getElementById('invGrid');
const coinsEl = document.getElementById('coins');
const crate = document.getElementById('crate');
const cratePlayer = document.getElementById('crate-player');
const openBtn = document.getElementById('openBtn');
const reveal = document.getElementById('reveal');
const revealImg = document.getElementById('revealImg');
const revealPlayerImg = document.getElementById('revealPlayerImg');
const revealName = document.getElementById('revealName');
const revealRarity = document.getElementById('revealRarity');
const closeReveal = document.getElementById('closeReveal');
const rarList = document.getElementById('rarList');

function renderPool(){poolEl.innerHTML=''; ITEMS.forEach(it=>{
  const d=document.createElement('div'); d.className='player';
  d.innerHTML = `<img src="${it.img}" alt="${it.name}"><div style='width:100%;display:flex;justify-content:space-between;align-items:center'><div style='font-weight:700'>${it.name}</div><div class='rarity ${it.rarity}'>${it.rarity}</div></div>`;
  poolEl.appendChild(d);
});}

function renderInventory(){invGrid.innerHTML=''; const keys=Object.keys(state.inventory);
  if(keys.length===0){invGrid.innerHTML='<div style="color:var(--muted);grid-column:1/-1">No items yet — open some crates!</div>';return}
  keys.forEach(k=>{const count=state.inventory[k]; const item=ITEMS.find(i=>i.id===k); const el=document.createElement('div'); el.className='inv-item'; el.innerHTML=`<img src='${item.img}'><div style='flex:1'><div style='font-weight:700'>${item.name}</div><div style='color:var(--muted);font-size:13px'>x ${count}</div></div>`; invGrid.appendChild(el)})}

function renderRarities(){rarList.innerHTML=''; Object.keys(RATES).forEach(r=>{
  const list = ITEMS.filter(i=>i.rarity===r);
  const container=document.createElement('div'); container.style.margin='8px 0'; container.innerHTML=`<strong style='text-transform:capitalize'>${r} — ${Math.round(RATES[r]*100)}%</strong>`;
  const row=document.createElement('div'); row.style.display='flex'; row.style.gap='8px'; row.style.marginTop='8px'; list.forEach(it=>{const c=document.createElement('div'); c.style.width='88px'; c.style.borderRadius='8px'; c.style.overflow='hidden'; c.style.background='rgba(255,255,255,0.02)'; c.innerHTML=`<img style='width:88px;height:64px;object-fit:cover' src='${it.img}'><div style='padding:6px;font-size:12px;text-align:center'>${it.name}</div>`; row.appendChild(c)}); container.appendChild(row); rarList.appendChild(container);
  });}

function renderAll(){coinsEl.textContent = `Coins: ${state.coins}`; renderInventory(); renderPool(); renderRarities(); renderStats();}

function renderStats(){const s=document.getElementById('statsArea'); s.innerHTML=`<div style='color:var(--muted)'>Crates opened: <strong>${state.opened}</strong></div><div style='color:var(--muted);margin-top:8px'>Unique players: <strong>${Object.keys(state.inventory).length}</strong></div>`}

/* ====== Utility: weighted pick by rarity ====== */
function weightedPick(){
  // pick rarity first
  const r = Math.random();
  let cumulative=0; let selectedRarity='common';
  for(const k of ['legendary','epic','rare','common']){
    cumulative += RATES[k];
    if(r <= cumulative){selectedRarity = k; break}
  }
  // pick an item of that rarity
  const candidates = ITEMS.filter(i=>i.rarity===selectedRarity);
  return candidates[Math.floor(Math.random()*candidates.length)];
}

/* ====== Opening logic & animations ====== */
let busy=false;
openBtn.addEventListener('click', async ()=>{
  if(busy) return; busy=true;
  if(state.coins < OPEN_COST){alert('Not enough coins — you need 10 coins to open a crate.'); busy=false; return}
  state.coins -= OPEN_COST; state.opened += 1; save(); renderAll();

  // visual: spin crate and shuffle images quickly
  crate.classList.add('spin');
  // pick final item ahead of time but keep hidden for suspense
  const prize = weightedPick();

  // quick random flicker of players for 900ms
  const flickerCount = 14; let i=0;
  const flicker = setInterval(()=>{
    const random = ITEMS[Math.floor(Math.random()*ITEMS.length)];
    cratePlayer.src = random.img; i++; if(i>flickerCount) clearInterval(flicker);
  }, 55);

  // wait for crate spin
  await new Promise(res=>setTimeout(res, 900));
  crate.classList.remove('spin');

  // reveal modal with nice animation
  reveal.classList.add('show');
  reveal.querySelector('.card').classList.add('show');
  revealImg.classList.add('show');
  revealPlayerImg.src = prize.img;
  revealName.textContent = prize.name;
  revealRarity.innerHTML = `<span class='rarity ${prize.rarity}'>${prize.rarity}</span>`;

  // add to inventory
  state.inventory[prize.id] = (state.inventory[prize.id] || 0) + 1;
  save(); renderAll();

  // confetti depending on rarity
  launchConfetti(prize.rarity);
  busy=false;
});

closeReveal.addEventListener('click', ()=>{reveal.classList.remove('show'); reveal.querySelector('.card').classList.remove('show'); setTimeout(()=>{revealImg.classList.remove('show')},200)})

document.getElementById('resetBtn').addEventListener('click', ()=>{
  if(confirm('Reset game and clear saved data?')){state={coins:200,inventory:{},opened:0}; save(); renderAll();}
});

/* ====== Tabs ====== */
document.querySelectorAll('.tabs .tab').forEach(t=>t.addEventListener('click',(e)=>{
  document.querySelectorAll('.tabs .tab').forEach(x=>x.classList.remove('active'));
  t.classList.add('active');
  const tab = t.dataset.tab;
  document.getElementById('poolView').style.display = tab==='pool' ? '' : 'none';
  document.getElementById('raritiesView').style.display = tab==='rarities' ? '' : 'none';
  document.getElementById('statsView').style.display = tab==='stats' ? '' : 'none';
}));

/* ====== Confetti (simple) ====== */
function launchConfetti(rarity){
  const count = rarity==='legendary' ? 80 : rarity==='epic' ? 45 : rarity==='rare' ? 25 : 12;
  for(let i=0;i<count;i++){
    const el = document.createElement('div'); el.className='confetti-piece';
    el.style.left = (30 + Math.random()*40) + '%';
    el.style.top = (20 + Math.random()*10) + '%';
    el.style.background = ['#ffd700','#ff6b6b','#6bffb0','#6bb8ff','#d06bff'][Math.floor(Math.random()*5)];
    el.style.transform = `translateY(-10px) rotate(${Math.random()*360}deg)`;
    el.style.opacity = 1;
    el.style.zIndex = 120;
    document.body.appendChild(el);
    // animate
    const dx = (Math.random()*120)-60; const dy = 300 + Math.random()*160; const rot = (Math.random()*720)-360; const dur = 1400 + Math.random()*900;
    el.animate([
      {transform:`translate(${dx/4}px,-10px) rotate(${rot/4}deg)`, opacity:1},
      {transform:`translate(${dx}px,${dy}px) rotate(${rot}deg)`, opacity:0}
    ],{duration:dur, easing:'cubic-bezier(.2,.8,.2,1)'}).onfinish = ()=>el.remove();
  }
}

/* ====== Init ====== */
load(); renderAll();

</script>
</body>
</html>
